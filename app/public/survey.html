<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>FriendFinder Survey</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-12">
                <form>
                    <hr>
                    <h2>Survey Questions</h2>
                    <hr>
                    <h3><strong>About You</strong></h3>

                    <div class="form-group">             
                        <h5>Name (Required)</h5>
                        <input type="text" id="name" class="form-control" required="">
                        <hr>
                    </div>
                    <div class="form-group">
                        <h5>Link to Photo Image (Required)</h5>
                        <input type="text" id="photo" class="form-control" required="">
                    </div>

                    <hr>

                    <div class="form-group">
                        <h3><strong>Question 1</strong></h3>
                        <h5>You consider yourself more creative than analytic.</h5>
                        <select class="chosen-select" id="q1">
                            <option value=""></option>
                            <option value="1">1 (Strongly Disagree)</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5 (Strongly Agree)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <h3><strong>Question 2</strong></h3>
                        <h5>You are generally more relaxed than stressed out.</h5>
                        <select class="chosen-select" id="q2">
                            <option value=""></option>
                            <option value="1">1 (Strongly Disagree)</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5 (Strongly Agree)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <h3><strong>Question 3</strong></h3>
                        <h5>You tend to act on your impulses.</h5>
                        <select class="chosen-select" id="q3">
                            <option value=""></option>
                            <option value="1">1 (Strongly Disagree)</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5 (Strongly Agree)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <h3><strong>Question 4</strong></h3>
                        <h5>You would prefer having a crazy night out instead of staying at home.</h5>
                        <select class="chosen-select" id="q4">
                            <option value=""></option>
                            <option value="1">1 (Strongly Disagree)</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5 (Strongly Agree)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <h3><strong>Question 5</strong></h3>
                        <h5>You have a difficult time understanding others.</h5>
                        <select class="chosen-select" id="q5">
                            <option value=""></option>
                            <option value="1">1 (Strongly Disagree)</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5 (Strongly Agree)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <h3><strong>Question 6</strong></h3>
                        <h5>You prioritize facts over others' beliefs.</h5>
                        <select class="chosen-select" id="q6">
                            <option value=""></option>
                            <option value="1">1 (Strongly Disagree)</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5 (Strongly Agree)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <h3><strong>Question 7</strong></h3>
                        <h5>You make an effort to read many books.</h5>
                        <select class="chosen-select" id="q7">
                            <option value=""></option>
                            <option value="1">1 (Strongly Disagree)</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5 (Strongly Agree)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <h3><strong>Question 8</strong></h3>
                        <h5>It is easy to become upset.</h5>
                        <select class="chosen-select" id="q8">
                            <option value=""></option>
                            <option value="1">1 (Strongly Disagree)</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5 (Strongly Agree)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <h3><strong>Question 9</strong></h3>
                        <h5>Your ideal vacation is a beach getaway.</h5>
                        <select class="chosen-select" id="q9">
                            <option value=""></option>
                            <option value="1">1 (Strongly Disagree)</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5 (Strongly Agree)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <h3><strong>Question 10</strong></h3>
                        <h5>You are often swept up in your imagination.</h5>
                        <select class="chosen-select" id="q10">
                            <option value=""></option>
                            <option value="1">1 (Strongly Disagree)</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5 (Strongly Agree)</option>
                        </select>
                    </div>

                    <hr>
                    <hr>
                
                    <button type="submit" class="btn btn-primary btn-lg btn-block" id="submit"><i class="fa fa-check-circle" aria-hidden="true"></i>
                        Submit</button>
                    <hr>
                </form>
            </div>
        </div>
    </div>

    <div id="match-modal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">Ã—</button>
                </div>
                <div class="modal-body">
                    <h2>Your Match: </h2>
                    <h2 id="match-name"></h2>
                    <h4 id="compatibility"></h4>
                    <img id="match-img" width="250px" src="https://fillmurray.com/200/300" alt="">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        $("#submit").on("click", function(event) {
            event.preventDefault();

            var newFriend = {
                friendName: $("#name").val().trim(),
                friendPhoto: $("#photo").val().trim(),
                scores: [
                    $("#q1").val().trim(),
                    $("#q2").val().trim(),
                    $("#q3").val().trim(),
                    $("#q4").val().trim(),
                    $("#q5").val().trim(),
                    $("#q6").val().trim(),
                    $("#q7").val().trim(),
                    $("#q8").val().trim(),
                    $("#q9").val().trim(),
                    $("#q10").val().trim()
                ]
            };

            console.log(newFriend);

            $.post("/api/friends", newFriend, function(data) {
                if (data) {
                    alert("friend added");
                }

                $("#name").val("");
                $("#photo").val("");
                $("#q1").val("");
                $("#q2").val("");
                $("#q3").val("");
                $("#q4").val("");
                $("#q5").val("");
                $("#q6").val("");
                $("#q7").val("");
                $("#q8").val("");
                $("#q9").val("");
                $("#q10").val("");
            });
            
            runFriendQuery();
            checkFriends();
        });

        function runFriendQuery() {
            $.ajax({ url: "/api/friends", method: "GET" })
                .then(function(friendData) {
                    console.log(friendData);
                });
        }

        function checkFriends() {
            $.ajax({ url: "/api/friends", method: "GET" })
                .then(function(friendData) {
                    var lastIndex = friendData.length - 1;
                    var lowestDiff = 10000000;
                    var bestMatch;
                    for (var i = 0; i < friendData.length - 1; i++) {
                        var scoreDiff = 0;
                        for (var j = 0; j < 10; j++) {
                            scoreDiff += Math.abs(friendData[i].scores[j] - friendData[lastIndex].scores[j]);
                        }
                        if (scoreDiff < lowestDiff) {
                            lowestDiff = scoreDiff;
                            bestMatch = friendData[i];
                        }
                    }
                    console.log("Best match: ");
                    console.log(bestMatch.friendName);
                    var compatScore = ((1 - (lowestDiff / 40)) * 100);
                    compatScore = Math.floor(compatScore);
                    console.log("Compatibility: " + compatScore + "%");
                    // console.log(JSON.stringify(bestMatch));
                    $("#match-name").text(bestMatch.friendName);
                    $("#match-img").attr("src", bestMatch.friendPhoto);
                    $("#compatibility").text("Compatibility score: " + Math.floor(compatScore) + "%");
                    $("#match-modal").modal("toggle");
                });
        }

        runFriendQuery();
    </script>
</body>

</html>
